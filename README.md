import asyncio
import os
import subprocess as sp
import win32api as wp
import shutil
import win32com.shell.shell as cmd


def del_tempFile():
    path = wp.GetEnvironmentVariable('TEMP')+'/'
    # cleantempfile_cmd = f"del %temp%\*.* / s / q"
    # sp.run(cleantempfile_cmd, shell=True)
    for i in os.listdir(path):
        if os.path.isfile(path+i):
            try:
                os.remove(path+i)
                print(f"Deleted: {path+i}")
            except Exception as e:
                print(f"Failed to delete: {path+i} because of: {e}")
        elif os.path.isdir(path+i):
            try:
                shutil.rmtree(path+i)
                print(f"Deleted: {path+i} ")
            except Exception as e:
                print(f"Failed to delete: {path+i} because of: {e}")


def del_prefetchFile():
    prefetch = f"C://Windows//Prefetch/"
    for i in os.listdir(prefetch):
        if os.path.isfile(prefetch+i):
            try:
                os.remove(prefetch+i)
                print(f"Deleted: {prefetch+i}")
            except Exception as e:
                print(f"Failed to delete: {prefetch+i} because of: {e}")
        elif os.path.isdir(prefetch+i):
            try:
                shutil.rmtree(prefetch+i)
            except Exception as e:
                print(f"Failed to delete: {prefetch+i} because of: {e}")


def del_winOld():
    del_winOld = """takeown /F C:\Windows.old\* /R /A
    icacls C:\Windows.old\*.* /T /grant administrators:F
    rmdir /S /Q C:\Windows.old\
    """
    cmd.ShellExecuteEx(lpVerb='runas', lpFile='cmd.exe',
                       lpParameters='/c '+del_winOld)


def main():

    del_winOld()
    del_tempFile()
    del_prefetchFile()
    wp.MessageBox(0, "Clean up successful", "Success", 0)


if __name__ == '__main__':
    main()
